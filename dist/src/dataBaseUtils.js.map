{"version":3,"sources":["../../src/dataBaseUtils.js"],"names":["setupConnection","stickerpackList","addStickerpack","db","connection","stickerpack","model","users","on","console","error","bind","connect","find","data","findOneAndUpdate","name","$inc","sendCount","returnNewDocument","then","result","newStickerpack","author","username","sendedPacks","user","save"],"mappings":";;;;;QAQgBA,e,GAAAA,e;QAIAC,e,GAAAA,e;QAIAC,c,GAAAA,c;;AAhBhB;;;;AACA;;AACA;;;;AACA,IAAMC,KAAK,mBAASC,UAApB;AACA,IAAMC,cAAc,mBAASC,KAAT,CAAe,aAAf,CAApB;AACA,IAAMC,QAAQ,mBAASD,KAAT,CAAe,OAAf,CAAd;AACAH,GAAGK,EAAH,CAAM,OAAN,EAAeC,QAAQC,KAAR,CAAcC,IAAd,CAAmBF,OAAnB,EAA4B,mBAA5B,CAAf;;AAEO,SAAST,eAAT,GAA2B;AAC9B,WAAO,mBAASY,OAAT,CAAiB,kCAAjB,CAAP;AACH;;AAEM,SAASX,eAAT,GAA2B;AAC/B,WAAOI,YAAYQ,IAAZ,EAAP;AACF;;AAEM,SAASX,cAAT,CAAwBY,IAAxB,EAA8B;AACjC;AACAT,gBACKU,gBADL,CAEQ,EAAEC,MAAMF,KAAKE,IAAb,EAFR,EAGQ,EAAEC,MAAM,EAAEC,WAAW,CAAb,EAAR,EAHR,EAIQ,EAAEC,mBAAmB,IAArB,EAJR,EAMKC,IANL,CAMU,kBAAU;AACZ;AACA,YAAI,CAACC,MAAL,EAAa;AACT,gBAAMC,iBAAiB,IAAIjB,WAAJ,CAAgB;AACnCW,sBAAMF,KAAKE,IADwB;AAEnCO,wBAAQT,KAAKS,MAFsB;AAGnCL,2BAAW;AAHwB,aAAhB,CAAvB;AAKAX,kBACKQ,gBADL,CAEQ,EAAES,UAAUV,KAAKS,MAAjB,EAFR,EAGQ,EAAEN,MAAM,EAAEQ,aAAa,CAAf,EAAR,EAHR,EAIQ,EAAEN,mBAAmB,IAArB,EAJR,EAMKC,IANL,CAMU,kBAAU;AACZ;AACA,oBAAI,CAACC,MAAL,EAAa;AACT,wBAAMK,OAAO,IAAInB,KAAJ,CAAU;AACnBiB,kCAAUV,KAAKS,MADI;AAEnBE,qCAAa;AAFM,qBAAV,CAAb;AAIAC,yBAAKC,IAAL;AACH;AACJ,aAfL;AAgBCL,2BAAeK,IAAf;AACA,mBAAO,IAAP;AACJ,SAxBD,MAwBO,OAAO,KAAP;AACV,KAjCL;AAkCH","file":"dataBaseUtils.js","sourcesContent":["import mongoose from 'mongoose';\nimport './models/stickerpack';\nimport './models/users';\nconst db = mongoose.connection;\nconst stickerpack = mongoose.model('stickerpack');\nconst users = mongoose.model('users');\ndb.on('error', console.error.bind(console, 'connection error:'));\n\nexport function setupConnection() {\n    return mongoose.connect('mongodb://localhost:27017/BOT_DB');\n}\n\nexport function stickerpackList() {\n   return stickerpack.find();\n}\n\nexport function addStickerpack(data) {\n    //console.log(data);\n    stickerpack\n        .findOneAndUpdate(\n            { name: data.name },\n            { $inc: { sendCount: 1 } },\n            { returnNewDocument: true },\n        )\n        .then(result => {\n            //console.log(result);\n            if (!result) {\n                const newStickerpack = new stickerpack({\n                    name: data.name,\n                    author: data.author,\n                    sendCount: 1,\n                });\n                users\n                    .findOneAndUpdate(\n                        { username: data.author },\n                        { $inc: { sendedPacks: 1 } },\n                        { returnNewDocument: true },\n                    )\n                    .then(result => {\n                        //console.log(result);\n                        if (!result) {\n                            const user = new users({\n                                username: data.author,\n                                sendedPacks: 1,\n                            });\n                            user.save();\n                        }\n                    });\n                 newStickerpack.save();\n                 return true;\n            } else return false;\n        });\n}\n"]}